:github_url: hide

.. DO NOT EDIT THIS FILE!!!
.. Generated automatically from Godot engine sources.
.. Generator: https://github.com/godotengine/godot/tree/master/doc/tools/make_rst.py.
.. XML source: https://github.com/godotengine/godot/tree/master/../_plugins/Terrain3D/doc/doc_classes/Terrain3DInstancer.xml.

.. _class_Terrain3DInstancer:

Terrain3DInstancer
==================

**Inherits:** ``Object``

.. rst-class:: classref-introduction-group

Description
-----------

This class places mesh instances defined in the Terrain3D asset dock into MultiMeshInstance3Ds on the ground.

Data is currently stored in :ref:`Terrain3DRegion.instances<class_Terrain3DRegion_property_instances>` and loaded into MultiMeshInstances, which are attached to the scene tree and managed by this class.

\ **The methods available for adding instances are:**\ 

- :ref:`add_transforms()<class_Terrain3DInstancer_method_add_transforms>` - Accepts your list of transforms and parses them by region and cell location and stores in our data storage. Recommended for general API instancing.

- :ref:`add_multimesh()<class_Terrain3DInstancer_method_add_multimesh>` - Pulls the transforms out of your MultiMesh and calls add_transforms.

- :ref:`add_instances()<class_Terrain3DInstancer_method_add_instances>` - A feature rich function designed for hand editing via Terrain3DEditor.

- Creating your own instance data and inserting it directly into :ref:`Terrain3DRegion.instances<class_Terrain3DRegion_property_instances>`. It's not difficult to do this in GDScript, but a thorough understanding of the C++ code in this class is recommended.

\ **The methods available for removing instances are:**\ 

- :ref:`remove_instances()<class_Terrain3DInstancer_method_remove_instances>` - Like add_instances, this is can be used procedurally but is designed for hand editing.

- :ref:`clear_by_mesh()<class_Terrain3DInstancer_method_clear_by_mesh>`, :ref:`clear_by_location()<class_Terrain3DInstancer_method_clear_by_location>` - To erase large sections of instances.

- Editing :ref:`Terrain3DRegion.instances<class_Terrain3DRegion_property_instances>` directly.

After modifying region data, run :ref:`update_mmis()<class_Terrain3DInstancer_method_update_mmis>` to rebuild the MultiMeshInstance3Ds.

\ **Read More:**\ 

- **Tutorial:** `Foliage Instancing <https://terrain3d.readthedocs.io/en/stable/docs/instancer.html>`__\ 

- **Godot Reference:** `MultiMesh <https://docs.godotengine.org/en/stable/classes/class_multimesh.html>`__

.. rst-class:: classref-reftable-group

Methods
-------

.. table::
   :widths: auto

   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`add_instances<class_Terrain3DInstancer_method_add_instances>`\ (\ global_position\: ``Vector3``, params\: ``Dictionary``\ )                                                                                                                                        |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`add_multimesh<class_Terrain3DInstancer_method_add_multimesh>`\ (\ mesh_id\: ``int``, multimesh\: ``MultiMesh``, transform\: ``Transform3D`` = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0), update\: ``bool`` = true\ )                                         |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`add_transforms<class_Terrain3DInstancer_method_add_transforms>`\ (\ mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray`` = PackedColorArray(), update\: ``bool`` = true\ )                                  |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`append_location<class_Terrain3DInstancer_method_append_location>`\ (\ region_location\: ``Vector2i``, mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray``, update\: ``bool`` = true\ )                     |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`append_region<class_Terrain3DInstancer_method_append_region>`\ (\ region\: :ref:`Terrain3DRegion<class_Terrain3DRegion>`, mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray``, update\: ``bool`` = true\ ) |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`clear_by_location<class_Terrain3DInstancer_method_clear_by_location>`\ (\ region_location\: ``Vector2i``, mesh_id\: ``int``\ )                                                                                                                                     |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`clear_by_mesh<class_Terrain3DInstancer_method_clear_by_mesh>`\ (\ mesh_id\: ``int``\ )                                                                                                                                                                             |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`clear_by_region<class_Terrain3DInstancer_method_clear_by_region>`\ (\ region\: :ref:`Terrain3DRegion<class_Terrain3DRegion>`, mesh_id\: ``int``\ )                                                                                                                 |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`dump_mmis<class_Terrain3DInstancer_method_dump_mmis>`\ (\ )                                                                                                                                                                                                        |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ``int`` | :ref:`get_closest_mesh_id<class_Terrain3DInstancer_method_get_closest_mesh_id>`\ (\ global_position\: ``Vector3``\ ) |const|                                                                                                                                             |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`remove_instances<class_Terrain3DInstancer_method_remove_instances>`\ (\ global_position\: ``Vector3``, params\: ``Dictionary``\ )                                                                                                                                  |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`swap_ids<class_Terrain3DInstancer_method_swap_ids>`\ (\ src_id\: ``int``, dest_id\: ``int``\ )                                                                                                                                                                     |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`update_mmis<class_Terrain3DInstancer_method_update_mmis>`\ (\ mesh_id\: ``int`` = -1, region_location\: ``Vector2i`` = Vector2i(2147483647, 2147483647), rebuild_all\: ``bool`` = false\ )                                                                         |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|  | :ref:`update_transforms<class_Terrain3DInstancer_method_update_transforms>`\ (\ aabb\: ``AABB``\ )                                                                                                                                                                       |
   +---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. rst-class:: classref-section-separator

----

.. rst-class:: classref-descriptions-group

Method Descriptions
-------------------

.. _class_Terrain3DInstancer_method_add_instances:

.. rst-class:: classref-method

|void| **add_instances**\ (\ global_position\: ``Vector3``, params\: ``Dictionary``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_add_instances>`

Used by Terrain3DEditor to place instances given many brush parameters. In addition to the brush position, it also uses the following parameters: asset_id:int, size:float, strength:float, fixed_scale:float, random_scale:float, fixed_spin:float, random_spin:float, fixed_tilt:float, random_tilt:float, align_to_normal:bool, height_offset:float, random_height:float, vertex_color:Color, random_hue:float, random_darken:float, slope:Vector2, on_collision:bool, raycast_height:float. All of these settings are set in the editor via tool_settings.gd.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_add_multimesh:

.. rst-class:: classref-method

|void| **add_multimesh**\ (\ mesh_id\: ``int``, multimesh\: ``MultiMesh``, transform\: ``Transform3D`` = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0), update\: ``bool`` = true\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_add_multimesh>`

Allows procedural placement of meshes, or importing from another MultiMeshInstancer placement tool. The specified mesh_id should already be setup as a :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` in the asset dock. This function extracts the instance transforms and colors from a multimesh and passes it to :ref:`add_transforms()<class_Terrain3DInstancer_method_add_transforms>`.

Update will regenerate the MultiMeshInstances. Disable for bulk adding, then call at the end.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_add_transforms:

.. rst-class:: classref-method

|void| **add_transforms**\ (\ mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray`` = PackedColorArray(), update\: ``bool`` = true\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_add_transforms>`

Allows procedural placement of meshes. The mesh_id should already be setup as a :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` in the asset dock. You provide the array of Transform3Ds and optional Colors, which will be parsed into our data storage.

This function adds the :ref:`Terrain3DMeshAsset.height_offset<class_Terrain3DMeshAsset_property_height_offset>` to the transform along its local Y axis.

Update will regenerate the MultiMeshInstances. Disable for bulk adding, then call at the end.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_append_location:

.. rst-class:: classref-method

|void| **append_location**\ (\ region_location\: ``Vector2i``, mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray``, update\: ``bool`` = true\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_append_location>`

Appends new transforms to the existing data within a region location. The mesh_id should already be setup as a :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` in the asset dock.

Update will regenerate the MultiMeshInstances. Disable for bulk adding, then call at the end.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_append_region:

.. rst-class:: classref-method

|void| **append_region**\ (\ region\: :ref:`Terrain3DRegion<class_Terrain3DRegion>`, mesh_id\: ``int``, transforms\: :ref:`Array<class_Array>`\[``Transform3D``\], colors\: ``PackedColorArray``, update\: ``bool`` = true\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_append_region>`

Appends new transforms to the existing data within a region location. The mesh_id should already be setup as a :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` in the asset dock.

Update will regenerate the MultiMeshInstances. Disable for bulk adding, then call at the end.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_clear_by_location:

.. rst-class:: classref-method

|void| **clear_by_location**\ (\ region_location\: ``Vector2i``, mesh_id\: ``int``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_clear_by_location>`

Removes all instancer data and MultiMeshInstance nodes attached to the tree for the specified region location and mesh id.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_clear_by_mesh:

.. rst-class:: classref-method

|void| **clear_by_mesh**\ (\ mesh_id\: ``int``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_clear_by_mesh>`

Removes all instancer data and MultiMeshInstance nodes attached to the tree for all regions for the specified mesh id.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_clear_by_region:

.. rst-class:: classref-method

|void| **clear_by_region**\ (\ region\: :ref:`Terrain3DRegion<class_Terrain3DRegion>`, mesh_id\: ``int``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_clear_by_region>`

Removes all instancer data and MultiMeshInstance nodes attached to the tree for the specified region and mesh id.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_dump_mmis:

.. rst-class:: classref-method

|void| **dump_mmis**\ (\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_dump_mmis>`

Dumps the MultiMeshInstance3Ds attached to the tree and information about the nodes for all regions.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_get_closest_mesh_id:

.. rst-class:: classref-method

``int`` **get_closest_mesh_id**\ (\ global_position\: ``Vector3``\ ) |const| :ref:`ðŸ”—<class_Terrain3DInstancer_method_get_closest_mesh_id>`

Returns the mesh instance ID closest to the specified global position on the ground.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_remove_instances:

.. rst-class:: classref-method

|void| **remove_instances**\ (\ global_position\: ``Vector3``, params\: ``Dictionary``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_remove_instances>`

Uses parameters asset_id:int, size:float, strength:float, slope:Vector2, on_collision:bool, raycast_height:float to randomly remove instances within the indicated brush position and size.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_swap_ids:

.. rst-class:: classref-method

|void| **swap_ids**\ (\ src_id\: ``int``, dest_id\: ``int``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_swap_ids>`

Swaps the ID of two meshes without changing the mesh instances on the ground.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_update_mmis:

.. rst-class:: classref-method

|void| **update_mmis**\ (\ mesh_id\: ``int`` = -1, region_location\: ``Vector2i`` = Vector2i(2147483647, 2147483647), rebuild_all\: ``bool`` = false\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_update_mmis>`

Queues a request to rebuild the MMIs for the specified IDs and regions on the next RenderingServer.frame_pre_draw signal. This is safe to call multiple times per frame and it will de-duplicate and do the most general requests. So if you first call it for region (0,0), mesh 52, then later in the frame ask for all regions, mesh 52, it will do only the latter.

- mesh_id - rebuild MMIs for this mesh id. Use `-1` for all IDs.

- region_location - rebuild MMIs for this region. Use `Vector2i.MAX` for all regions.

- rebuild_all - destroy all MMIs first before rebuilding.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_update_transforms:

.. rst-class:: classref-method

|void| **update_transforms**\ (\ aabb\: ``AABB``\ ) :ref:`ðŸ”—<class_Terrain3DInstancer_method_update_transforms>`

Reviews all existing instance transforms within an AABB and adjusts their heights to match the terrain.

.. |virtual| replace:: :abbr:`virtual (This method should typically be overridden by the user to have any effect.)`
.. |const| replace:: :abbr:`const (This method has no side effects. It doesn't modify any of the instance's member variables.)`
.. |vararg| replace:: :abbr:`vararg (This method accepts any number of arguments after the ones described here.)`
.. |constructor| replace:: :abbr:`constructor (This method is used to construct a type.)`
.. |static| replace:: :abbr:`static (This method doesn't need an instance to be called, so it can be called directly using the class name.)`
.. |operator| replace:: :abbr:`operator (This method describes a valid operator to use with this type as left-hand operand.)`
.. |bitfield| replace:: :abbr:`BitField (This value is an integer composed as a bitmask of the following flags.)`
.. |void| replace:: :abbr:`void (No return value.)`
