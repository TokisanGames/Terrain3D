:github_url: hide

.. DO NOT EDIT THIS FILE!!!
.. Generated automatically from Godot engine sources.
.. Generator: https://github.com/godotengine/godot/tree/4.3/doc/tools/make_rst.py.
.. XML source: https://github.com/godotengine/godot/tree/4.3/../_plugins/Terrain3D/doc/classes/Terrain3DInstancer.xml.

.. _class_Terrain3DInstancer:

Terrain3DInstancer
==================

**Inherits:** :ref:`Object<class_Object>`

.. rst-class:: classref-introduction-group

Description
-----------

This class places mesh instances into MultiMeshInstance3Ds defined in the Terrain3D asset dock. 

Data is currently stored in MultiMeshes within a Dictionary :ref:`Terrain3DRegion.multimeshes<class_Terrain3DRegion_property_multimeshes>`, per region, per mesh type. These MultiMeshes are loaded into MultiMeshInstances, which are attached to the scene tree and managed by this class.

\ **The methods available for adding instances are:**\ 

- :ref:`add_instances<class_Terrain3DInstancer_method_add_instances>` - A feature rich function designed for hand editing via Terrain3DEditor.

- :ref:`add_multimesh<class_Terrain3DInstancer_method_add_multimesh>` - Pulls the transforms out of your MultiMesh and calls add_transforms.

- :ref:`add_transforms<class_Terrain3DInstancer_method_add_transforms>` - Accepts your list of transforms and parses them into our data storage.

- Creating your own MultiMesh resources and inserting them directly into the :ref:`Terrain3DRegion.multimeshes<class_Terrain3DRegion_property_multimeshes>` dictionary. It's not difficult to do this in GDScript, but a thorough understanding of the C++ code in this class is recommended. Specifically look at `update_multimesh()`.

\ **The methods available for removing instances are:**\ 

- :ref:`remove_instances<class_Terrain3DInstancer_method_remove_instances>` - Like add_instances, this is can be used procedurally but is designed for hand editing.

- :ref:`clear_by_mesh<class_Terrain3DInstancer_method_clear_by_mesh>`, :ref:`clear_by_location<class_Terrain3DInstancer_method_clear_by_location>` - To erase large sections of instances

\ **Note:** one caveat about creating your own MultiMeshes is the instance count cannot be changed after creation. Should you wish to remove 50% of the transforms, you would need to make a new MultiMesh, copy over the mesh and settings, copy the 50% of the transforms you wish to keep, and assign it to the MultiMeshInstance3D. That is how the instancer updates the MMIs.

.. rst-class:: classref-reftable-group

Methods
-------

.. table::
   :widths: auto

   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`add_instances<class_Terrain3DInstancer_method_add_instances>`\ (\ global_position\: :ref:`Vector3<class_Vector3>`, params\: :ref:`Dictionary<class_Dictionary>`\ )                                                                                                                                                                                       |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`add_multimesh<class_Terrain3DInstancer_method_add_multimesh>`\ (\ mesh_id\: :ref:`int<class_int>`, multimesh\: :ref:`MultiMesh<class_MultiMesh>`, transform\: :ref:`Transform3D<class_Transform3D>` = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)\ )                                                                                                 |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`add_transforms<class_Terrain3DInstancer_method_add_transforms>`\ (\ mesh_id\: :ref:`int<class_int>`, transforms\: :ref:`Array<class_Array>`\[:ref:`Transform3D<class_Transform3D>`\], colors\: :ref:`Array<class_Array>`\[:ref:`Color<class_Color>`\] = []\ )                                                                                            |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`append_multimesh<class_Terrain3DInstancer_method_append_multimesh>`\ (\ region_location\: :ref:`Vector2i<class_Vector2i>`, mesh_id\: :ref:`int<class_int>`, transforms\: :ref:`Array<class_Array>`\[:ref:`Transform3D<class_Transform3D>`\], colors\: :ref:`Array<class_Array>`\[:ref:`Color<class_Color>`\], clear\: :ref:`bool<class_bool>` = false\ ) |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`clear_by_location<class_Terrain3DInstancer_method_clear_by_location>`\ (\ region_location\: :ref:`Vector2i<class_Vector2i>`, mesh_id\: :ref:`int<class_int>`\ )                                                                                                                                                                                          |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`clear_by_mesh<class_Terrain3DInstancer_method_clear_by_mesh>`\ (\ mesh_id\: :ref:`int<class_int>`\ )                                                                                                                                                                                                                                                     |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`force_update_mmis<class_Terrain3DInstancer_method_force_update_mmis>`\ (\ )                                                                                                                                                                                                                                                                              |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Dictionary<class_Dictionary>` | :ref:`get_mmis<class_Terrain3DInstancer_method_get_mmis>`\ (\ ) |const|                                                                                                                                                                                                                                                                                        |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`remove_instances<class_Terrain3DInstancer_method_remove_instances>`\ (\ global_position\: :ref:`Vector3<class_Vector3>`, params\: :ref:`Dictionary<class_Dictionary>`\ )                                                                                                                                                                                 |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`set_cast_shadows<class_Terrain3DInstancer_method_set_cast_shadows>`\ (\ mesh_id\: :ref:`int<class_int>`, mode\: :ref:`ShadowCastingSetting<enum_GeometryInstance3D_ShadowCastingSetting>`\ )                                                                                                                                                             |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`swap_ids<class_Terrain3DInstancer_method_swap_ids>`\ (\ src_id\: :ref:`int<class_int>`, dest_id\: :ref:`int<class_int>`\ )                                                                                                                                                                                                                               |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                              | :ref:`update_transforms<class_Terrain3DInstancer_method_update_transforms>`\ (\ aabb\: :ref:`AABB<class_AABB>`\ )                                                                                                                                                                                                                                              |
   +-------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. rst-class:: classref-section-separator

----

.. rst-class:: classref-descriptions-group

Method Descriptions
-------------------

.. _class_Terrain3DInstancer_method_add_instances:

.. rst-class:: classref-method

|void| **add_instances**\ (\ global_position\: :ref:`Vector3<class_Vector3>`, params\: :ref:`Dictionary<class_Dictionary>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_add_instances>`

Used by Terrain3DEditor to place instances given many brush parameters. In addition to the brush position, it also uses the following parameters: asset_id, size, strength, fixed_scale, random_scale, fixed_spin, random_spin, fixed_angle, random_angle, align_to_normal, height_offset, random_height, vertex_color, random_hue, random_darken. All of these settings are set in the editor through tool_settings.gd.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_add_multimesh:

.. rst-class:: classref-method

|void| **add_multimesh**\ (\ mesh_id\: :ref:`int<class_int>`, multimesh\: :ref:`MultiMesh<class_MultiMesh>`, transform\: :ref:`Transform3D<class_Transform3D>` = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0)\ ) :ref:`🔗<class_Terrain3DInstancer_method_add_multimesh>`

Allows procedural placement of meshes. The :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` mesh_id should already be setup. This extracts the instance transforms and colors from a multimesh and passes it to :ref:`add_transforms<class_Terrain3DInstancer_method_add_transforms>`.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_add_transforms:

.. rst-class:: classref-method

|void| **add_transforms**\ (\ mesh_id\: :ref:`int<class_int>`, transforms\: :ref:`Array<class_Array>`\[:ref:`Transform3D<class_Transform3D>`\], colors\: :ref:`Array<class_Array>`\[:ref:`Color<class_Color>`\] = []\ ) :ref:`🔗<class_Terrain3DInstancer_method_add_transforms>`

Allows procedural placement of meshes. The :ref:`Terrain3DMeshAsset<class_Terrain3DMeshAsset>` mesh_id should already be setup. Then you provide the array of Transform3Ds and optional Colors, which will be parsed into our region based data storage and fed directly into the appropriate MultiMeshInstances.

This function adds the :ref:`Terrain3DMeshAsset.height_offset<class_Terrain3DMeshAsset_property_height_offset>` to the transform along its local Y axis.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_append_multimesh:

.. rst-class:: classref-method

|void| **append_multimesh**\ (\ region_location\: :ref:`Vector2i<class_Vector2i>`, mesh_id\: :ref:`int<class_int>`, transforms\: :ref:`Array<class_Array>`\[:ref:`Transform3D<class_Transform3D>`\], colors\: :ref:`Array<class_Array>`\[:ref:`Color<class_Color>`\], clear\: :ref:`bool<class_bool>` = false\ ) :ref:`🔗<class_Terrain3DInstancer_method_append_multimesh>`

Appends new transforms to existing multimeshes. Multimesh transform arrays cannot be modified and must be rebuilt. This will make a new array with both old and new transforms. `Clear` will skip the old array.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_clear_by_location:

.. rst-class:: classref-method

|void| **clear_by_location**\ (\ region_location\: :ref:`Vector2i<class_Vector2i>`, mesh_id\: :ref:`int<class_int>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_clear_by_location>`

Removes MultiMeshInstance nodes attached to the tree, and MultiMeshes in Terrain3DRegions that match both the region location and the mesh id.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_clear_by_mesh:

.. rst-class:: classref-method

|void| **clear_by_mesh**\ (\ mesh_id\: :ref:`int<class_int>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_clear_by_mesh>`

Removes MultiMeshInstance nodes attached to the tree, and MultiMeshes in Terrain3DRegions that match the mesh id.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_force_update_mmis:

.. rst-class:: classref-method

|void| **force_update_mmis**\ (\ ) :ref:`🔗<class_Terrain3DInstancer_method_force_update_mmis>`

Removes and rebuilds all MultiMeshInstances.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_get_mmis:

.. rst-class:: classref-method

:ref:`Dictionary<class_Dictionary>` **get_mmis**\ (\ ) |const| :ref:`🔗<class_Terrain3DInstancer_method_get_mmis>`

Returns the dictionary containing the MultiMeshInstance3D nodes, which are hidden children of Terrain3D. The dictionary is keyed by Vector3i(region_location.x, region_location.y, mesh_id).

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_remove_instances:

.. rst-class:: classref-method

|void| **remove_instances**\ (\ global_position\: :ref:`Vector3<class_Vector3>`, params\: :ref:`Dictionary<class_Dictionary>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_remove_instances>`

Uses parameters asset_id, size, strength, fixed_scale, random_scale, to randomly remove instances within the indicated brush position and size.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_set_cast_shadows:

.. rst-class:: classref-method

|void| **set_cast_shadows**\ (\ mesh_id\: :ref:`int<class_int>`, mode\: :ref:`ShadowCastingSetting<enum_GeometryInstance3D_ShadowCastingSetting>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_set_cast_shadows>`

Tells the renderer how to cast shadows from this mesh asset onto the terrain and other objects. This sets ``GeometryInstance3D.ShadowCastingSetting`` on all MultiMeshInstances for the specified mesh. This function is called by :ref:`Terrain3DMeshAsset.cast_shadows<class_Terrain3DMeshAsset_property_cast_shadows>`, but you can also call it manually.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_swap_ids:

.. rst-class:: classref-method

|void| **swap_ids**\ (\ src_id\: :ref:`int<class_int>`, dest_id\: :ref:`int<class_int>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_swap_ids>`

Swaps the ID of two meshes, without changing the mesh instances on the ground. Updates Multimesh and MMI dictionary keys.

.. rst-class:: classref-item-separator

----

.. _class_Terrain3DInstancer_method_update_transforms:

.. rst-class:: classref-method

|void| **update_transforms**\ (\ aabb\: :ref:`AABB<class_AABB>`\ ) :ref:`🔗<class_Terrain3DInstancer_method_update_transforms>`

Reviews all existing instance transforms within an AABB and adjusts their heights to match the terrain.

.. |virtual| replace:: :abbr:`virtual (This method should typically be overridden by the user to have any effect.)`
.. |const| replace:: :abbr:`const (This method has no side effects. It doesn't modify any of the instance's member variables.)`
.. |vararg| replace:: :abbr:`vararg (This method accepts any number of arguments after the ones described here.)`
.. |constructor| replace:: :abbr:`constructor (This method is used to construct a type.)`
.. |static| replace:: :abbr:`static (This method doesn't need an instance to be called, so it can be called directly using the class name.)`
.. |operator| replace:: :abbr:`operator (This method describes a valid operator to use with this type as left-hand operand.)`
.. |bitfield| replace:: :abbr:`BitField (This value is an integer composed as a bitmask of the following flags.)`
.. |void| replace:: :abbr:`void (No return value.)`
